<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Music45 - Spotify & YouTube Audio</title>
  <script src="https://kit.fontawesome.com/YOUR-FONTAWESOME-KEY.js" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1c1c1c;
      color: white;
      padding-bottom: 140px;
      margin: 0;
    }
    .search-container {
      margin: 20px;
      text-align: center;
    }
    input {
      padding: 10px;
      width: 60%;
      max-width: 400px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #444;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      background: #ff4757;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #e84118;
    }
    .song-item {
      display: flex;
      align-items: center;
      margin: 10px auto;
      padding: 10px;
      background: #333;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      cursor: pointer;
    }
    .song-item img {
      width: 80px;
      height: 80px;
      border-radius: 5px;
      margin-right: 10px;
    }
    .song-item p {
      flex-grow: 1;
      text-align: left;
    }

    #music-player {
      display: none;
    }

    .footer-player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 120px;
      background: #2f3542;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 1000;
      flex-wrap: wrap;
    }

    .footer-song-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .footer-song-info img {
      width: 60px;
      height: 60px;
      border-radius: 5px;
    }
    .footer-song-text {
      text-align: left;
    }
    .footer-song-text .title {
      font-weight: bold;
    }

    .footer-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .footer-controls i {
      font-size: 24px;
      color: white;
      cursor: pointer;
    }

    .progress-container {
      flex: 1;
      margin: 10px 0 0;
      width: 100%;
    }
    .progress-bar {
      width: 100%;
      height: 5px;
      background: #555;
      cursor: pointer;
    }
    .progress-fill {
      height: 5px;
      background: #ff4757;
      width: 0%;
    }
    .time-info {
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      padding: 0 5px;
    }

    @media (max-width: 600px) {
      .footer-player {
        flex-direction: column;
        height: auto;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="search-container">
    <input type="text" id="search-query" placeholder="Enter song name..." />
    <button onclick="searchSongs()">Search</button>
  </div>

  <div id="song-list"></div>
  <div id="music-player"></div>

  <!-- Footer -->
  <div class="footer-player">
    <div class="footer-song-info">
      <img src="https://via.placeholder.com/60" alt="cover" id="footer-cover">
      <div class="footer-song-text">
        <div class="title" id="footer-title">No Song</div>
        <div class="artist" id="footer-artist">---</div>
      </div>
    </div>
    <div class="footer-controls">
      <i class="fas fa-random" onclick="shuffleSong()"></i>
      <i class="fas fa-redo" onclick="toggleRepeat()"></i>
      <i class="fas fa-play" id="playPauseIcon" onclick="playPause()"></i>
      <i class="fas fa-download" onclick="downloadSong()"></i>
      <i class="fas fa-share-alt" onclick="shareSong()"></i>
    </div>
    <div class="progress-container">
      <div class="progress-bar" onclick="seek(event)">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="time-info">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
      </div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const SPOTIFY_CLIENT_ID = '7afe6b39346f4bcc8654c141fe2a6136';
    const SPOTIFY_CLIENT_SECRET = '119278484c2f4c28ac893ea3324bfe84';
    const YOUTUBE_API_KEY = 'AIzaSyAwKYDbklOiCO1o3Dr7uM-xISbjksPkgDk';

    let spotifyToken = '', player, isPlayerReady = false, isPlaying = false;
    let lastVideoId = null, repeat = false, songQueue = [], currentIndex = 0;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('music-player', {
        height: '0', width: '0', videoId: '',
        playerVars: { autoplay: 0, controls: 0, rel: 0, modestbranding: 1 },
        events: {
          onReady: () => isPlayerReady = true,
          onStateChange: (e) => {
            if (e.data === YT.PlayerState.ENDED) {
              if (repeat) player.seekTo(0);
              else playNextRandom();
            }
          }
        }
      });
    }

    async function getSpotifyToken() {
      const res = await fetch('https://accounts.spotify.com/api/token', {
        method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `grant_type=client_credentials&client_id=${SPOTIFY_CLIENT_ID}&client_secret=${SPOTIFY_CLIENT_SECRET}`
      });
      const data = await res.json();
      spotifyToken = data.access_token;
    }

    async function searchSongs() {
      const query = document.getElementById('search-query').value.trim();
      if (!query) return alert("Enter a song name!");
      await getSpotifyToken();
      const res = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=5`, {
        headers: { Authorization: `Bearer ${spotifyToken}` }
      });
      const data = await res.json();
      displaySongs(data.tracks.items);
    }

    async function displaySongs(songs) {
      const container = document.getElementById('song-list');
      container.innerHTML = '';
      songQueue = songs;
      for (let i = 0; i < songs.length; i++) {
        const song = songs[i];
        const title = song.name, artist = song.artists[0].name, cover = song.album.images[1].url;
        const item = document.createElement('div');
        item.className = 'song-item';
        item.innerHTML = `<img src="${cover}"/><p>${title} - ${artist}</p>`;
        item.onclick = async () => {
          currentIndex = i;
          const vid = await getYouTubeVideo(`${title} ${artist} official audio`);
          if (vid && isPlayerReady) playSong(vid, title, artist, cover);
        };
        container.appendChild(item);
      }
    }

    async function getYouTubeVideo(query) {
      const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=1&videoEmbeddable=true&key=${YOUTUBE_API_KEY}`);
      const data = await res.json();
      return data.items[0]?.id.videoId || null;
    }

    function playSong(videoId, title, artist, cover) {
      lastVideoId = videoId;
      player.loadVideoById(videoId);
      isPlaying = true;
      document.getElementById('footer-cover').src = cover;
      document.getElementById('footer-title').textContent = title;
      document.getElementById('footer-artist').textContent = artist;
      document.getElementById('playPauseIcon').className = 'fas fa-pause';
    }

    function playPause() {
      if (!player || !player.getPlayerState) return;
      const state = player.getPlayerState();
      const icon = document.getElementById('playPauseIcon');
      if (state === YT.PlayerState.PLAYING) { player.pauseVideo(); icon.className = 'fas fa-play'; isPlaying = false; }
      else if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.ENDED) { player.playVideo(); icon.className = 'fas fa-pause'; isPlaying = true; }
    }

    function shuffleSong() {
      const random = Math.floor(Math.random() * songQueue.length);
      currentIndex = random;
      const song = songQueue[random];
      getYouTubeVideo(`${song.name} ${song.artists[0].name} official audio`).then(id => playSong(id, song.name, song.artists[0].name, song.album.images[1].url));
    }

    function toggleRepeat() {
      repeat = !repeat;
      alert('Repeat is now ' + (repeat ? 'ON' : 'OFF'));
    }

    function playNextRandom() {
      if (songQueue.length > 1) shuffleSong();
    }

    function updateProgress() {
      if (player && isPlayerReady && player.getCurrentTime) {
        const cur = player.getCurrentTime();
        const dur = player.getDuration();
        if (dur) {
          document.getElementById('progressFill').style.width = `${(cur/dur)*100}%`;
          document.getElementById('currentTime').textContent = formatTime(cur);
          document.getElementById('duration').textContent = formatTime(dur);
        }
      }
      requestAnimationFrame(updateProgress);
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function seek(event) {
      const bar = event.currentTarget;
      const percent = event.offsetX / bar.offsetWidth;
      const dur = player.getDuration();
      player.seekTo(dur * percent);
    }

    function downloadSong() {
      if (lastVideoId) window.open(`https://yt-download.org/api/button/mp3/${lastVideoId}`, '_blank');
    }

    function shareSong() {
      navigator.clipboard.writeText(location.href).then(() => alert("Link copied!"));
    }

    window.onload = async () => {
      await getSpotifyToken();
      const res = await fetch('https://api.spotify.com/v1/browse/new-releases?limit=10', {
        headers: { Authorization: `Bearer ${spotifyToken}` }
      });
      const data = await res.json();
      const top = data.albums.items.map(a => ({ name: a.name, artists: [{ name: a.artists[0].name }], album: { images: a.images } }));
      displaySongs(top);
      updateProgress();
    };
  </script>
</body>
</html>
