<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music45 - JioSaavn API</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:20px; }
    #search-box { padding:10px; width:60%; border-radius:8px; border:none; }
    #search-btn { padding:10px 15px; background:#1db954; border:none; border-radius:8px; color:#fff; cursor:pointer; }
    #results { margin-top:20px; display:grid; gap:15px; }
    .song { display:flex; align-items:center; gap:15px; background:#222; padding:10px; border-radius:10px; cursor:pointer; }
    .song img { width:60px; height:60px; border-radius:8px; }
    audio { width:100%; margin-top:20px; }
  </style>
</head>
<body>
  <h1>ðŸŽµ Music45 (JioSaavn API)</h1>

  <input id="search-box" type="text" placeholder="Search songs...">
  <button id="search-btn">Search</button>

  <div id="results"></div>

  <div id="player" style="display:none; margin-top:20px;">
    <h3 id="song-title"></h3>
    <p id="song-artist"></p>
    <img id="song-img" width="200" style="border-radius:10px;"><br>
    <audio id="audio-player" controls autoplay></audio>
  </div>

  <script>
    document.getElementById("search-btn").addEventListener("click", searchSongs);

    async function searchSongs() {
      const query = document.getElementById("search-box").value.trim();
      if (!query) return alert("Enter song name!");

      const url = `https://saavn.dev/api/search/songs?query=${encodeURIComponent(query)}`;
      try {
        const res = await fetch(url);
        const data = await res.json();

        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";

        if (!data?.data?.results?.length) {
          resultsDiv.innerText = "No results found!";
          return;
        }

        data.data.results.forEach(song => {
          const div = document.createElement("div");
          div.className = "song";
          div.innerHTML = `
            <img src="${song.image[1].link}">
            <div>
              <b>${song.name}</b><br>
              <small>${song.primaryArtists}</small>
            </div>
          `;
          div.onclick = () => playSong(song.id);
          resultsDiv.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        alert("Error fetching songs");
      }
    }

    async function playSong(songId) {
  try {
    const res = await fetch(`https://saavn.dev/api/songs?ids=${songId}`);
    const data = await res.json();
    const song = data.data[0];

    // pick highest quality download URL
    const audioUrl = song.downloadUrl?.slice(-1)[0]?.link; 

    if (!audioUrl) {
      alert("No playable URL found for this song");
      return;
    }

    document.getElementById("song-title").innerText = song.name;
    document.getElementById("song-artist").innerText = song.primaryArtists;
    document.getElementById("song-img").src = song.image?.slice(-1)[0]?.link;
    document.getElementById("audio-player").src = audioUrl;

    document.getElementById("player").style.display = "block";
  } catch (err) {
    console.error(err);
    alert("Failed to load song");
  }
}

  </script>
</body>
</html>
